# Copyright 2025 NVIDIA CORPORATION & AFFILIATES
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
# SPDX-License-Identifier: Apache-2.0
breakout:
  swplb:
    2:
      - name: Number of PFs
        value: 2
        dmsPath: /nvidia/physical-functions/config/num-of-pf
        valueType: int
      - name: Number of Planes
        value: 0
        mlxconfig: "NUM_OF_PLANES_P1"
      - name: LAG Resource Allocation
        value: 0
        mlxconfig: "LAG_RESOURCE_ALLOCATION"
      # CX8-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..3"
        alternativeValue: "[0,1,2,3]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 2
        value: "4..7"
        alternativeValue: "[4,5,6,7]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 255
        value: "8..15"
        alternativeValue: "[8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes
        deviceId: "1023"
      # BF3-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..1"
        alternativeValue: "[0,1]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 2
        value: "2..3"
        alternativeValue: "[2,3]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 255
        value: "4..15"
        alternativeValue: "[4,5,6,7,8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes
        deviceId: "a2dc"
    4:
      - name: Number of PFs
        value: 4
        dmsPath: /nvidia/physical-functions/config/num-of-pf
        valueType: int
      - name: Number of Planes
        value: 0
        mlxconfig: "NUM_OF_PLANES_P1"
      - name: LAG Resource Allocation
        value: 0
        mlxconfig: "LAG_RESOURCE_ALLOCATION"
      # CX8-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..1"
        alternativeValue: "[0,1]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 2
        value: "2..3"
        alternativeValue: "[2,3]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 3
        value: "4..5"
        alternativeValue: "[4,5]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 4
        value: "6..7"
        alternativeValue: "[6,7]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "1023"  
      - name: Lanes for Module 0 and Port 255
        value: "8..15"
        alternativeValue: "[8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes
        deviceId: "1023"
      # BF3-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..0"
        alternativeValue: "[0]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 2
        value: "1..1"
        alternativeValue: "[1]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 3
        value: "2..2"
        alternativeValue: "[2]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=3]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 4
        value: "3..3"
        alternativeValue: "[3]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=4]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 255
        value: "4..15"
        alternativeValue: "[4,5,6,7,8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes
        deviceId: "a2dc"
  hwplb:
    2:
      - name: Number of PFs
        value: 2
        dmsPath: /nvidia/physical-functions/config/num-of-pf
        valueType: int
      - name: Number of Planes
        value: 2
        mlxconfig: "NUM_OF_PLANES_P1"
      - name: LAG Resource Allocation
        value: 1
        mlxconfig: "LAG_RESOURCE_ALLOCATION"
      # CX8-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..7"
        alternativeValue: "[0,1,2,3,4,5,6,7]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 255
        value: "8..15"
        alternativeValue: "[8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes
        deviceId: "1023"
    4:
      - name: Number of PFs
        value: 4
        dmsPath: /nvidia/physical-functions/config/num-of-pf
        valueType: int
      - name: Number of Planes
        value: 4
        mlxconfig: "NUM_OF_PLANES_P1"
      - name: LAG Resource Allocation
        value: 1
        mlxconfig: "LAG_RESOURCE_ALLOCATION"
      # CX8-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..7"
        alternativeValue: "[0,1,2,3,4,5,6,7]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 255
        value: "8..15"
        alternativeValue: "[8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes  
        deviceId: "1023" 
  uniplane:
    2:
      - name: Number of PFs
        value: 2
        dmsPath: /nvidia/physical-functions/config/num-of-pf
        valueType: int
      - name: Number of Planes P1
        value: 0
        mlxconfig: "NUM_OF_PLANES_P1"
      - name: Number of Planes P2
        value: 0
        mlxconfig: "NUM_OF_PLANES_P2"
      - name: LAG Resource Allocation
        value: 0
        mlxconfig: "LAG_RESOURCE_ALLOCATION"
      # CX8-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..3"
        alternativeValue: "[0,1,2,3]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 2
        value: "4..7"
        alternativeValue: "[4,5,6,7]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "1023"
      - name: Lanes for Module 0 and Port 255
        value: "8..15"
        alternativeValue: "[8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes
        deviceId: "1023"
      # BF3-specific parameters  
      - name: Lanes for Module 0 and Port 1
        value: "0..1"
        alternativeValue: "[0,1]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=1]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 2
        value: "2..3"
        alternativeValue: "[2,3]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=2]/lanes
        deviceId: "a2dc"
      - name: Lanes for Module 0 and Port 255
        value: "4..15"
        alternativeValue: "[4,5,6,7,8,9,10,11,12,13,14,15]"
        valueType: string
        dmsPath: /nvidia/device/config/module[module-id=0]/port[port-id=255]/lanes
        deviceId: "a2dc"
nvConfig:
  - name: Ethernet mode
    dmsPath: /interfaces/interface/config/type
    valueType: string
    value: ethernetCsmacd
  - name: Enable SR-IOV
    value: 1
    mlxconfig: "SRIOV_EN"
  - name: Set NUM_OF_VFS
    value: 1
    mlxconfig: "NUM_OF_VFS"
  - name: NIC mode
    value: NIC
    dmsPath: /nvidia/mode/config/mode
    valueType: string
    deviceId: "a2dc"
  - name: RoCE Adaptive Routing
    value: true
    dmsPath: /nvidia/roce/config/adaptive-routing
    valueType: bool
  - name: Programmable Congestion Control
    value: true
    dmsPath: /nvidia/cc/config/user-programmable
    valueType: bool
  - name: RoCE TX Scheduling Locality Mode
    value: TX_SCHED_LOCALITY_ACCUMULATIVE
    dmsPath: /nvidia/roce/config/tx-sched-locality-mode
    valueType: string
  - name: RoCE CC Steering Ext
    value: ENABLED
    dmsPath: /nvidia/roce/config/cc-steering-ext
    valueType: string
  # swplb/uniplane-specific settings (via DMS)
  - name: CNP DSCP
    value: 0
    dmsPath: /interfaces/interface/nvidia/roce/config/rtt-resp-dscp
    valueType: int
    multiplane: swplb
  - name: CNP DSCP
    value: 0
    dmsPath: /interfaces/interface/nvidia/roce/config/rtt-resp-dscp
    valueType: int
    multiplane: uniplane
  - name: CNP DSCP mode
    value: RTT_RESP_DSCP_DEFAULT
    dmsPath: /interfaces/interface/nvidia/roce/config/rtt-resp-dscp-mode
    valueType: string
    multiplane: swplb
  - name: CNP DSCP mode
    value: RTT_RESP_DSCP_DEFAULT
    dmsPath: /interfaces/interface/nvidia/roce/config/rtt-resp-dscp-mode
    valueType: string
    multiplane: uniplane
  - name: RoCE Multipath DSCP
    value: MULTIPATH_DSCP_DEFAULT
    dmsPath: /nvidia/roce/config/multipath-dscp
    valueType: string
    alternativeValue: "unknown"
    ignoreError: true
    multiplane: swplb
  - name: RoCE Multipath DSCP
    value: MULTIPATH_DSCP_DEFAULT
    dmsPath: /nvidia/roce/config/multipath-dscp
    valueType: string
    alternativeValue: "unknown"
    ignoreError: true
    multiplane: uniplane
  # hwplb-specific settings (via mlxconfig)
  - name: CNP DSCP
    value: 48
    mlxconfig: "ROCE_RTT_RESP_DSCP_P1"
    multiplane: hwplb
  - name: CNP DSCP mode
    value: 1
    mlxconfig: "ROCE_RTT_RESP_DSCP_MODE_P1"
    multiplane: hwplb
  - name: Flex Parser Profile
    value: 10
    mlxconfig: "FLEX_PARSER_PROFILE_ENABLE"
    multiplane: hwplb
  - name: Disable RDE
    value: 1
    mlxconfig: "RDE_DISABLE"
    multiplane: hwplb
  - name: VF LOG BAR size
    value: 5
    mlxconfig: "VF_LOG_BAR_SIZE"
    multiplane: hwplb
runtimeConfig:
  roce:
    - name: Trust
      value: dscp
      dmsPath: /interfaces/interface/nvidia/qos/config/trust-mode
      valueType: string
      alternativeValue: QOS_TRUST_MODE_DSCP
    - name: PFC
      value: "00010000"
      dmsPath: /interfaces/interface/nvidia/qos/config/pfc
      valueType: string
    - name: Type of Service
      value: 96
      dmsPath: /interfaces/interface/nvidia/roce/config/tos
      valueType: int
  adaptiveRouting:
    - name: Enable CC per plane
      value: true
      dmsPath: /interfaces/interface/nvidia/roce/config/cc-per-plane
      valueType: bool
      multiplane: hwplb
    - name: Adaptive Retransmission
      value: true
      dmsPath: /interfaces/interface/nvidia/roce/config/adaptive-retransmission
      valueType: bool
    - name: Tx Window
      value: true
      dmsPath: /interfaces/interface/nvidia/roce/config/tx-window
      valueType: bool
    - name: Slow Restart
      value: false
      dmsPath: /interfaces/interface/nvidia/roce/config/slow-restart
      valueType: bool
    - name: Slow Restart Idle
      value: false
      dmsPath: /interfaces/interface/nvidia/roce/config/slow-restart-idle
      valueType: bool
    # TODO: Uncomment when DMS is fixed in DOCA 3.3.0
    - name: CC Probe MP mode
      value: true
      dmsPath: /interfaces/interface/nvidia/roce/config/cc-probe-mp-mode
      valueType: bool
      multiplane: hwplb
    - name: Adaptive Routing Force
      value: true
      dmsPath: /interfaces/interface/nvidia/roce/config/adaptive-routing-force
      valueType: bool
  congestionControl:
    - name: Congestion Control on RP points
      value: true
      dmsPath:  /interfaces/interface/nvidia/cc/config/priority/rp_enabled # priority[id=0..7]
      valueType: bool
      alternativeValue: "1"
    - name:  Congestion Control on NP points
      value: true
      dmsPath: /interfaces/interface/nvidia/cc/config/priority/np_enabled # priority[id=0..7]
      valueType: bool
      alternativeValue: "1"
    - name: Congestion Control  
      value: true
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/config/enabled
      valueType: bool
    - name: Congestion Control with Counters
      value: true
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/config/counter_enable
      valueType: bool
    - name: DCQCN
      value: false
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=15]/config/enabled
      valueType: bool
    # Bandwidth configuration for different cases
    - name: Bandwidth
      value: 400
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=0]/config/value
      valueType: int
      deviceId: "1023"
      breakout: 2
    - name: Bandwidth
      value: 200
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=0]/config/value
      valueType: int
      deviceId: "1023"
      breakout: 4
    - name: Bandwidth
      value: 200
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=0]/config/value
      valueType: int
      deviceId: "a2dc"
      breakout: 2
    - name: Bandwidth
      value: 100
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=0]/config/value
      valueType: int
      deviceId: "a2dc"
      breakout: 4
    - name: Responsiveness Alpha Factor
      value: 6553
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=1]/config/value
      valueType: int
    - name: Maximum Decrease Factor
      value: 63570
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=2]/config/value
      valueType: int
    - name: Maximum Increase Factor
      value: 69468
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=3]/config/value
      valueType: int
    - name: Additive Increase Step Size
      value: 96
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=4]/config/value
      valueType: int
    - name: High Additive Increase Step Size
      value: 1700
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=5]/config/value
      valueType: int
    - name: High Additive Increase Interval Period
      value: 2000000
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=6]/config/value
      valueType: int
    - name: ZTR_CC_CONGESTION_DELAY_THRESHOLD
      value: 13000
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=7]/config/value
      valueType: int
    - name: Maximum Queuing Delay
      value: 250000
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=8]/config/value
      valueType: int
    - name: Rate on First Congestion
      value: 524288
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=9]/config/value
      valueType: int
    - name: Delay Only
      value: 0
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=10]/config/value
      valueType: int
    - name: CNP Validity
      value: 1
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=11]/config/value
      valueType: int
    - name: Transmit Rate Decrement Step
      value: 1
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=12]/config/value
      valueType: int
    - name: Fixed Transmission Rate
      value: 0
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=13]/config/value
      valueType: int
    - name: Fast Scheduling Factor
      value: 2097152
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=14]/config/value
      valueType: int
    - name: Topology Awareness
      value: 1
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=15]/config/value
      valueType: int
    - name: Advanced Features
      value: 1
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=16]/config/value
      valueType: int
    - name: Troubleshooting Capabilities
      value: 0
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=17]/config/value
      valueType: int
    - name: CC_FIXED_CWND
      value: 0
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=18]/config/value
      valueType: int
    - name: Enable CC Plane Failure Detection
      value: 1
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=19]/config/value
      valueType: int
    - name: CC Plane Failure Threshold
      value: 3
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=20]/config/value
      valueType: int
    - name: CC Plane Recovery Threshold
      value: 1
      dmsPath: /interfaces/interface/nvidia/cc/slot[id=0]/param[id=21]/config/value
      valueType: int
  interPacketGap:
    pureL3:
      - name: Inter Packet Gap for no overlay
        value: 25
        dmsPath: /interfaces/interface/ethernet/nvidia/config/inter-packet-gap
        valueType: int
    l3EVPN:
      - name: Inter Packet Gap for L3 EVPN overlay
        value: 33
        dmsPath: /interfaces/interface/ethernet/nvidia/config/inter-packet-gap
        valueType: int
#docaCCVersion: 3.3.0090-1
docaCCVersion: 3.3.0
useSoftwareCCAlgorithm: true
